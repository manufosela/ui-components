<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arc Slider - @manufosela/ui-components</title>
    <style>
      :root {
        --bg-color: #f5f5f7;
        --card-bg: #ffffff;
        --text-color: #1d1d1f;
        --text-muted: #86868b;
        --border-color: #d2d2d7;
        --accent: #3b82f6;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0;
        padding: 2rem;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--accent);
        text-decoration: none;
        margin-bottom: 2rem;
      }

      .back-link:hover {
        text-decoration: underline;
      }

      header {
        text-align: center;
        margin-bottom: 3rem;
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .subtitle {
        color: var(--text-muted);
        font-size: 1.1rem;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 2rem;
      }

      .demo-card {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      .demo-card h2 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 0 0 0.5rem 0;
      }

      .demo-card p {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin: 0 0 1.5rem 0;
      }

      .demo-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 120px;
      }

      .value-display {
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background: var(--bg-color);
        border-radius: 8px;
        font-family: 'SF Mono', Monaco, monospace;
        font-size: 0.9rem;
      }

      .code-block {
        background: #1d1d1f;
        color: #f5f5f7;
        padding: 1rem;
        border-radius: 8px;
        font-family: 'SF Mono', Monaco, monospace;
        font-size: 0.85rem;
        overflow-x: auto;
        margin-top: 1rem;
      }

      .interactive-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }

      .control-group label {
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      .control-group input[type='color'],
      .control-group input[type='number'] {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 0.9rem;
      }

      .control-group input[type='color'] {
        width: 60px;
        height: 36px;
        padding: 2px;
      }

      .control-group input[type='number'] {
        width: 80px;
      }

      arc-slider {
        --arc-slider-width: 15em;
      }

      footer {
        text-align: center;
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid var(--border-color);
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      footer a {
        color: var(--text-color);
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "lit": "https://esm.sh/lit@3.2.1",
          "lit/": "https://esm.sh/lit@3.2.1/"
        }
      }
    </script>
  </head>
  <body>
    <div class="container">
      <a href="../index.html" class="back-link">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        Back to components
      </a>

      <header>
        <h1>Arc Slider</h1>
        <p class="subtitle">A customizable arc slider web component with gradient colors</p>
      </header>

      <div class="demo-grid">
        <!-- Basic Example -->
        <div class="demo-card">
          <h2>Basic Usage</h2>
          <p>Default configuration with 0-100 range</p>
          <div class="demo-content">
            <arc-slider id="basic"></arc-slider>
            <div class="value-display">Value: <span id="basic-value">50</span></div>
          </div>
          <div class="code-block">&lt;arc-slider&gt;&lt;/arc-slider&gt;</div>
        </div>

        <!-- Custom Range -->
        <div class="demo-card">
          <h2>Custom Range</h2>
          <p>Negative to positive range (-50 to 50)</p>
          <div class="demo-content">
            <arc-slider id="range" min-range="-50" max-range="50" arc-value="0"></arc-slider>
            <div class="value-display">Value: <span id="range-value">0</span></div>
          </div>
          <div class="code-block">&lt;arc-slider min-range="-50" max-range="50"&gt;&lt;/arc-slider&gt;</div>
        </div>

        <!-- Custom Colors -->
        <div class="demo-card">
          <h2>Custom Colors</h2>
          <p>Green to blue gradient</p>
          <div class="demo-content">
            <arc-slider id="colors" color1="#22C55E" color2="#3B82F6"></arc-slider>
            <div class="value-display">Value: <span id="colors-value">50</span></div>
          </div>
          <div class="code-block">&lt;arc-slider color1="#22C55E" color2="#3B82F6"&gt;&lt;/arc-slider&gt;</div>
        </div>

        <!-- Temperature Example -->
        <div class="demo-card">
          <h2>Temperature Control</h2>
          <p>Practical use case with cold-hot colors</p>
          <div class="demo-content">
            <arc-slider id="temp" min-range="16" max-range="30" arc-value="22" color1="#0EA5E9" color2="#EF4444"></arc-slider>
            <div class="value-display"><span id="temp-value">22</span>Â°C</div>
          </div>
          <div class="code-block">&lt;arc-slider min-range="16" max-range="30" color1="#0EA5E9" color2="#EF4444"&gt;&lt;/arc-slider&gt;</div>
        </div>

        <!-- Disabled -->
        <div class="demo-card">
          <h2>Disabled State</h2>
          <p>Non-interactive slider</p>
          <div class="demo-content">
            <arc-slider id="disabled" arc-value="75" disabled></arc-slider>
            <div class="value-display">Value: 75 (disabled)</div>
          </div>
          <div class="code-block">&lt;arc-slider disabled arc-value="75"&gt;&lt;/arc-slider&gt;</div>
        </div>

        <!-- Interactive -->
        <div class="demo-card">
          <h2>Interactive Playground</h2>
          <p>Try different configurations</p>
          <div class="demo-content">
            <arc-slider id="playground"></arc-slider>
            <div class="value-display">Value: <span id="playground-value">50</span></div>
          </div>
          <div class="interactive-controls">
            <div class="control-group">
              <label>Color 1</label>
              <input type="color" id="ctrl-color1" value="#FF1122" />
            </div>
            <div class="control-group">
              <label>Color 2</label>
              <input type="color" id="ctrl-color2" value="#1122FF" />
            </div>
            <div class="control-group">
              <label>Min</label>
              <input type="number" id="ctrl-min" value="0" />
            </div>
            <div class="control-group">
              <label>Max</label>
              <input type="number" id="ctrl-max" value="100" />
            </div>
          </div>
        </div>
      </div>

      <footer>
        <p>
          <a href="https://github.com/manufosela/ui-components/tree/main/packages/arc-slider">View Source</a> |
          <a href="https://www.npmjs.com/package/@manufosela/arc-slider">npm</a>
        </p>
      </footer>
    </div>

    <script type="module">
      // Inline component for GitHub Pages demo (using import maps)
      import { LitElement, html, css } from 'lit';

      const arcSliderStyles = css`
        :host {
          display: block;
          --arc-slider-text-color: #000;
          --arc-slider-thumb-size: 1.25em;
          --arc-slider-width: 12.5em;
        }

        :host([disabled]) {
          opacity: 0.5;
          pointer-events: none;
        }

        .slider-wrapper {
          display: flex;
          justify-content: center;
          align-items: center;
          position: relative;
          width: var(--arc-slider-width);
          max-width: 100%;
          user-select: none;
          margin-top: 2rem;
          padding: 1rem;
        }

        .slider-input {
          position: absolute;
          opacity: 0;
          pointer-events: none;
        }

        .slider-thumb {
          --color: #fff;
          display: flex;
          justify-content: center;
          align-items: center;
          position: absolute;
          z-index: 1;
          transform: translate(-50%, -50%);
          border-radius: 50%;
          width: var(--arc-slider-thumb-size);
          height: var(--arc-slider-thumb-size);
          background-image: linear-gradient(to bottom, #f0f0f2, #d9dade);
          box-shadow: 0 0.0625em 0.0625em rgba(0, 0, 0, 0.3);
          user-select: none;
          touch-action: none;
          cursor: pointer;
        }

        .slider-thumb::before {
          content: '';
          position: absolute;
          border-radius: inherit;
          width: 68%;
          height: 68%;
          background-color: var(--color);
          box-shadow: inset 0 -8px 4px rgba(0, 0, 0, 0.1);
        }

        .slider-value-container {
          display: flex;
          justify-content: center;
          align-items: center;
          position: absolute;
          bottom: 0;
          transform: translateY(-100%);
          border: 1px solid #dbdbe3;
          border-radius: 5rem;
          padding: 0.25rem 0.75rem;
          background-color: #f2f2f3;
          box-shadow: 0 0.0625rem 0.25rem rgba(0, 0, 0, 0.1);
          font-size: 0.9rem;
          font-feature-settings: 'tnum';
          font-variant-numeric: tabular-nums;
          white-space: nowrap;
          pointer-events: none;
          user-select: none;
          color: var(--arc-slider-text-color);
        }

        .slider-svg {
          width: 100%;
          height: 100%;
          filter: drop-shadow(0 1px 0 #fff);
          overflow: visible;
        }

        .slider-svg-path {
          touch-action: none;
          cursor: pointer;
        }
      `;

      class ArcSlider extends LitElement {
        static styles = arcSliderStyles;

        static properties = {
          minRange: { type: Number, attribute: 'min-range' },
          maxRange: { type: Number, attribute: 'max-range' },
          arcValue: { type: Number, attribute: 'arc-value', reflect: true },
          step: { type: Number },
          disabled: { type: Boolean, reflect: true },
          color1: { type: String },
          color2: { type: String },
        };

        constructor() {
          super();
          this.minRange = 0;
          this.maxRange = 100;
          this.step = 1;
          this.disabled = false;
          this.color1 = '#FF1122';
          this.color2 = '#1122FF';
          this._colorStops = [];
          this._arcValueManualChanged = false;
          this._handlePointerMove = this._handlePointerMove.bind(this);
          this._handlePointerDown = this._handlePointerDown.bind(this);
        }

        get _middleRange() {
          return (this.maxRange + this.minRange) / 2;
        }

        connectedCallback() {
          super.connectedCallback();
          if (this.arcValue === undefined) this.arcValue = this._middleRange;
        }

        firstUpdated() {
          this._initColorStops();
          this._sliderThumb = this.shadowRoot.querySelector('.slider-thumb');
          this._sliderInput = this.shadowRoot.querySelector('.slider-input');
          this._sliderValue = this.shadowRoot.querySelector('.slider-value');
          this._drawSVGLine();
          this._updatePosition(this._valueToProgress(this.arcValue));
        }

        updated(changedProperties) {
          if (changedProperties.has('arcValue') && !this._arcValueManualChanged) {
            const oldValue = changedProperties.get('arcValue');
            if (oldValue !== undefined && this.arcValue !== oldValue) {
              this._updatePosition(this._valueToProgress(this.arcValue));
            }
          }
          this._arcValueManualChanged = false;
          if (changedProperties.has('color1') || changedProperties.has('color2')) {
            this._initColorStops();
            if (this._sliderPath) this._redrawGradient();
          }
        }

        static hexToRgb(hex) {
          const cleanHex = hex.replace('#', '');
          return {
            r: parseInt(cleanHex.substring(0, 2), 16),
            g: parseInt(cleanHex.substring(2, 4), 16),
            b: parseInt(cleanHex.substring(4, 6), 16),
          };
        }

        static rgbToHex({ r, g, b }) {
          return `#${[r, g, b].map(v => v.toString(16).padStart(2, '0')).join('').toUpperCase()}`;
        }

        static calculateGradientColors(c1, c2, steps = 4) {
          const colors = [];
          for (let i = 0; i <= steps + 1; i++) {
            const t = i / (steps + 1);
            colors.push({
              r: Math.round(c1.r + (c2.r - c1.r) * t),
              g: Math.round(c1.g + (c2.g - c1.g) * t),
              b: Math.round(c1.b + (c2.b - c1.b) * t),
            });
          }
          return colors;
        }

        _initColorStops() {
          const rgb1 = ArcSlider.hexToRgb(this.color1);
          const rgb2 = ArcSlider.hexToRgb(this.color2);
          this._colorStops = ArcSlider.calculateGradientColors(rgb1, rgb2);
        }

        _valueToProgress(value) {
          return (value - this.minRange) / (this.maxRange - this.minRange);
        }

        _setThumbColor(progress) {
          if (!this._colorStops.length) return;
          const index = (this._colorStops.length - 1) * progress;
          const startIndex = Math.floor(index);
          const endIndex = Math.min(Math.ceil(index), this._colorStops.length - 1);
          const startColor = this._colorStops[startIndex];
          const endColor = this._colorStops[endIndex];
          const t = index - startIndex;
          const r = Math.round(startColor.r + (endColor.r - startColor.r) * t);
          const g = Math.round(startColor.g + (endColor.g - startColor.g) * t);
          const b = Math.round(startColor.b + (endColor.b - startColor.b) * t);
          this._sliderThumb?.style.setProperty('--color', `rgb(${r} ${g} ${b})`);
        }

        _updatePosition(progress) {
          if (!this._sliderPath || !this._sliderSvg || !this._sliderThumb) return;
          const clampedProgress = Math.min(Math.max(progress, 0), 1);
          const point = this._sliderPath.getPointAtLength(clampedProgress * this._sliderPathLength);
          const svgRect = this._sliderSvg.getBoundingClientRect();
          const viewBox = this._sliderSvg.viewBox.baseVal;
          if (!viewBox.width || !viewBox.height) return;
          const scaleX = svgRect.width / viewBox.width;
          const scaleY = svgRect.height / viewBox.height;
          this._sliderThumb.style.left = `${(point.x * scaleX * 100) / svgRect.width}%`;
          this._sliderThumb.style.top = `${(point.y * scaleY * 100) / svgRect.height}%`;
          const newValue = Math.round(this.minRange + clampedProgress * (this.maxRange - this.minRange));
          this.arcValue = newValue;
          this._arcValueManualChanged = true;
          if (this._sliderValue) this._sliderValue.textContent = newValue;
          this._setThumbColor(clampedProgress);
        }

        _handlePointerDown(event) {
          if (this.disabled) return;
          const sliderWidth = this._sliderPath.getBoundingClientRect().width;
          const pointerX = event.clientX - this._sliderPath.getBoundingClientRect().left;
          const progress = Math.min(Math.max(pointerX / sliderWidth, 0), 1);
          if (!event.target.classList.contains('slider-thumb')) {
            this._updatePosition(progress);
            this._dispatchChange();
          }
          window.addEventListener('pointermove', this._handlePointerMove);
          window.addEventListener('pointerup', () => {
            window.removeEventListener('pointermove', this._handlePointerMove);
            this._dispatchChange();
          }, { once: true });
        }

        _handlePointerMove(event) {
          if (this.disabled) return;
          const sliderWidth = this._sliderPath.getBoundingClientRect().width;
          const pointerX = event.clientX - this._sliderPath.getBoundingClientRect().left;
          const progress = Math.min(Math.max(pointerX / sliderWidth, 0), 1);
          this._updatePosition(progress);
        }

        _dispatchChange() {
          this.dispatchEvent(new CustomEvent('change', {
            detail: { id: this.id, value: this.arcValue },
            bubbles: true,
            composed: true,
          }));
        }

        _drawSVGLine() {
          const wrapper = this.shadowRoot.querySelector('.slider-wrapper');
          if (!wrapper) return;
          const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
          svg.setAttribute('class', 'slider-svg');
          svg.setAttribute('viewBox', '0 0 238 36');
          svg.setAttribute('fill', 'none');
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          path.setAttribute('class', 'slider-svg-path');
          path.setAttribute('d', 'M2 34L7.21879 31.0968C78.5901 -8.60616 165.659 -7.50128 236 34V34');
          path.setAttribute('stroke', 'url(#arc-gradient)');
          path.setAttribute('stroke-width', '.25em');
          path.setAttribute('stroke-linecap', 'round');
          path.setAttribute('vector-effect', 'non-scaling-stroke');
          const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
          const gradient = this._createGradient();
          defs.appendChild(gradient);
          svg.appendChild(path);
          svg.appendChild(defs);
          wrapper.insertBefore(svg, wrapper.firstChild);
          this._sliderSvg = svg;
          this._sliderPath = path;
          this._sliderPathLength = path.getTotalLength();
          path.addEventListener('pointerdown', this._handlePointerDown);
          this._sliderThumb.addEventListener('pointerdown', this._handlePointerDown);
        }

        _createGradient() {
          const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
          gradient.setAttribute('id', 'arc-gradient');
          gradient.setAttribute('gradientUnits', 'userSpaceOnUse');
          this._colorStops.forEach((color, index) => {
            const stop = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
            stop.setAttribute('offset', `${index / (this._colorStops.length - 1)}`);
            stop.setAttribute('stop-color', ArcSlider.rgbToHex(color));
            gradient.appendChild(stop);
          });
          return gradient;
        }

        _redrawGradient() {
          const defs = this._sliderSvg?.querySelector('defs');
          if (!defs) return;
          const oldGradient = defs.querySelector('#arc-gradient');
          if (oldGradient) oldGradient.remove();
          defs.appendChild(this._createGradient());
        }

        render() {
          return html`
            <div class="slider-wrapper">
              <input class="slider-input" type="range" max="${this.maxRange - this.minRange}" min="0" step="${this.step}" ?disabled=${this.disabled} aria-label="Arc slider" />
              <div class="slider-thumb">
                <div class="slider-value-container">
                  <span class="slider-value">${this.arcValue ?? this._middleRange}</span>
                </div>
              </div>
            </div>
          `;
        }
      }

      customElements.define('arc-slider', ArcSlider);

      // Demo interactivity
      const sliders = { basic: 'basic', range: 'range', colors: 'colors', temp: 'temp', playground: 'playground' };
      Object.keys(sliders).forEach(key => {
        const slider = document.getElementById(key);
        if (slider) {
          slider.addEventListener('change', e => {
            const display = document.getElementById(`${key}-value`);
            if (display) display.textContent = e.detail.value;
          });
        }
      });

      const playground = document.getElementById('playground');
      document.getElementById('ctrl-color1').addEventListener('input', e => { playground.color1 = e.target.value; });
      document.getElementById('ctrl-color2').addEventListener('input', e => { playground.color2 = e.target.value; });
      document.getElementById('ctrl-min').addEventListener('input', e => { playground.minRange = parseInt(e.target.value, 10); });
      document.getElementById('ctrl-max').addEventListener('input', e => { playground.maxRange = parseInt(e.target.value, 10); });
    </script>
  </body>
</html>
